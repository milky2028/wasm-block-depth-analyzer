# WASM Block Depth Analyzer

All smarter parsers and lexers failed to be able to do this task, so we use a simple script here.
Thankfully, the output generated by `wasm2wat` is also pretty simple. This script would be incorrect or error-prone for .wat generated from other sources, as it relies on the fact that `wasm2wat` only emits one function per line.

- Install Web Assembly Binary Toolkit and Deno: `brew install wabt deno`
- Generate a .wat file from a .wasm file: `wasm2wat input.wasm -o output.wat --enable-all`
- Run this script: `deno run --allow-read analyze.ts your-wat-file.wat`
- Pipe the output to a JSON file to examine the results: `deno run --allow-read analyze.ts your-wat-file.wat >> try-data.json`

The size PS Web's .wat file is unweidy for VS Code to handle.
To make dealing with functions easier, take the output generated by this script and run it through the sed command (built into Mac).

For example, given:
```json
{
  "name": "$CloudPSDWriter::WriteCPSDData_ImageWriteParameters_const&__ImageFileSheetListData*__StandardImageFileDataOptions_const&__short__bool__TImageDocument*_",
  "start": 21074078,
  "end": 21080587,
  "length": 6509,
  "try_statements": 207,
  "max_depth": 39
}
```

`sed -i '' '21074078,21080587!d' your-wat-file.wat`

This will cut out everything except the function you're working with, which is much easier for the editor to handle.
